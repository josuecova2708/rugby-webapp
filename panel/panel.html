<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Rendimiento - Rugby 360</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="./stylePanel.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <header>
        <nav>
            <div class="logo">RUGBY <span>360</span></div>
            <div class="nav-buttons">
                <!-- Aquí se insertará la navegación dinámicamente -->
            </div>
        </nav>
    </header>

    <main class="panel-main">
        <div class="panel-container">
            <!-- Header con botón de volver -->
            <div class="panel-header">
                <button class="back-home-btn" onclick="window.location.href='../index.html'">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1>Panel de Rendimiento</h1>
            </div>

            <!-- Pestañas de navegación -->
            <div class="panel-tabs">
                <button class="tab-btn active" data-tab="gimnasio">
                    Gimnasio
                </button>
                <button class="tab-btn" data-tab="asistencias">
                    Asistencias
                </button>
                <button class="tab-btn" data-tab="desempeno">
                    Desempeño técnico
                </button>
            </div>

            <!-- Contenido de las pestañas -->
            <div class="panel-content">
                
                <!-- Pestaña Gimnasio (activa por defecto) -->
                <div class="tab-content active" id="gimnasio">
                    <div class="gimnasio-section">
                        <div class="performance-table-container">
                            <table class="performance-table">
                                <thead>
                                    <tr>
                                        <th>Ejercicios</th>
                                        <th>Repeticiones</th>
                                        <th>KG</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Sentadilla</td>
                                        <td>4</td>
                                        <td>85</td>
                                    </tr>
                                    <tr>
                                        <td>Pecho</td>
                                        <td>4</td>
                                        <td>90</td>
                                    </tr>
                                    <tr>
                                        <td>Dominadas</td>
                                        <td>5</td>
                                        <td>100</td>
                                    </tr>
                                    <tr>
                                        <td>Arranque</td>
                                        <td>5</td>
                                        <td>100</td>
                                    </tr>
                                    <tr>
                                        <td>Peso muerto</td>
                                        <td>4</td>
                                        <td>100</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Información adicional -->
                        <div class="gym-stats">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-dumbbell"></i>
                                </div>
                                <div class="stat-info">
                                    <h3>Última sesión</h3>
                                    <p>15 de Marzo - 18:30</p>
                                </div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="stat-info">
                                    <h3>Progreso semanal</h3>
                                    <p>+5% fuerza general</p>
                                </div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-trophy"></i>
                                </div>
                                <div class="stat-info">
                                    <h3>Record personal</h3>
                                    <p>Sentadilla: 85kg</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pestaña Asistencias -->
                <div class="tab-content" id="asistencias" style="display: none;">
                    <div class="asistencias-section">
                        <h2>Consulta tus asistencias por fecha</h2>
                        
                        <div class="asistencias-container">
                            <!-- Calendario -->
                            <div class="calendar-section">
                                <div class="calendar-header">
                                    <button id="prevMonth" class="calendar-nav-btn">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <h3 id="currentMonth">marzo</h3>
                                    <button id="nextMonth" class="calendar-nav-btn">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                                
                                <div class="calendar-grid">
                                    <div class="calendar-days-header">
                                        <span>lun</span>
                                        <span>mar</span>
                                        <span>mié</span>
                                        <span>jue</span>
                                        <span>vie</span>
                                        <span>sáb</span>
                                        <span>dom</span>
                                    </div>
                                    <div class="calendar-days" id="calendarDays">
                                        <!-- Los días se generarán dinámicamente -->
                                    </div>
                                </div>
                            </div>

                            <!-- Gráfico y leyenda -->
                            <div class="chart-section">
                                <div class="chart-container">
                                    <canvas id="attendanceChart" width="200" height="200"></canvas>
                                    <div class="chart-percentage">
                                        <span id="attendancePercentage">65%</span>
                                    </div>
                                </div>
                                
                                <div class="chart-legend">
                                    <div class="legend-item">
                                        <div class="legend-color" style="background-color: #9747FF;"></div>
                                        <span>Asiste</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-color" style="background-color: #108B37;"></div>
                                        <span>No asiste</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-color" style="background-color: #CF5904;"></div>
                                        <span>Asiste lesionado</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-color" style="background-color: #00ACC1;"></div>
                                        <span>Llegó tarde</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tabla de resumen -->
                        <div class="attendance-table-container">
                            <table class="attendance-table">
                                <thead>
                                    <tr>
                                        <th>Entrenamiento</th>
                                        <th>Nombre</th>
                                        <th>Puesto</th>
                                        <th>Clasificación</th>
                                        <th>Asistencia</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Fecha</td>
                                        <td>Usuario</td>
                                        <td>Centro 12</td>
                                        <td>8</td>
                                        <td>65%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Pestaña Desempeño técnico (inicialmente oculta) -->
                <div class="tab-content" id="desempeno" style="display: none;">
                    <div class="desempeno-section">
                        
                        <!-- Sección superior: Progreso físico y masa corporal -->
                        <div class="desempeno-top-section">
                            <!-- Gráfico de progreso físico -->
                            <div class="chart-container-tech">
                                <h3><i class="fas fa-chart-line"></i> Progreso físico</h3>
                                <div class="line-chart-container">
                                    <canvas id="progressChart" width="400" height="200"></canvas>
                                </div>
                            </div>

                            <!-- Gráfico de masa muscular y grasa corporal -->
                            <div class="chart-container-tech">
                                <h3>Masa muscular y grasa corporal:</h3>
                                <div class="body-composition-section">
                                    <div class="composition-chart-container">
                                        <canvas id="bodyCompositionChart" width="200" height="200"></canvas>
                                    </div>
                                    <div class="composition-legend">
                                        <div class="legend-item">
                                            <div class="legend-color" style="background-color: #9747FF;"></div>
                                            <span>Grasa corporal moderada</span>
                                        </div>
                                        <div class="legend-item">
                                            <div class="legend-color" style="background-color: #7CB342;"></div>
                                            <span>Grasa corporal alta</span>
                                        </div>
                                        <div class="legend-item">
                                            <div class="legend-color" style="background-color: #2E7D32;"></div>
                                            <span>Masa muscular óptima</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Sección inferior: Rendimiento semanal y foto del jugador -->
                        <div class="desempeno-bottom-section">
                            <!-- Gráfico de rendimiento semanal -->
                            <div class="chart-container-tech">
                                <h3>Rendimiento semanal</h3>
                                <div class="bar-chart-container">
                                    <canvas id="weeklyPerformanceChart" width="500" height="250"></canvas>
                                </div>
                            </div>

                            <!-- Tarjeta del jugador -->
                            <div class="player-card">
                              <img src="../recursos/player-card.png" alt="">
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-logo">
                <div class="rugby-ball-icon">
                    <img src="../recursos/balon-logo.svg" alt="">
                </div>
            </div>
            <div class="contacto-nosotros">
                <div class="contact-info">
                    <h3>Contacto</h3>
                    <p><i class="fas fa-phone"></i> (+54) 11 3456-7890</p>
                    <p><i class="fas fa-envelope"></i> loscardosclub@gmail.com</p>
                </div>

                <div class="nosotros">
                    <h3>Nosotros</h3>
                    <p>Acerca del club</p>
                </div>
            </div>

            <div class="terms">
                <p>Términos y condiciones</p>
                <div class="social-media">
                    <a href="#" class="social-icon facebook">
                        <img src="../recursos/facebook-logo.svg" alt="">
                    </a>
                    <a href="#" class="social-icon instagram">
                        <img src="../recursos/instagram-logo.svg" alt="">
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script src="../auth.js"></script>
    <script>
        // Datos de asistencias para marzo 2025 (ejemplo para backend)
        const attendanceData = {
            2025: {
                2: { // Marzo (0-indexed)
                    9: { status: 'asiste', type: 'training' },      // 9 marzo
                    10: { status: 'no-asiste', type: 'training' },  // 10 marzo
                    11: { status: 'asiste', type: 'training' },     // 11 marzo
                    12: { status: 'tarde', type: 'training' },      // 12 marzo
                    13: { status: 'asiste', type: 'match' },        // 13 marzo
                    14: { status: 'tarde', type: 'training' },      // 14 marzo
                    15: { status: 'asiste', type: 'training' },     // 15 marzo
                    16: { status: 'asiste', type: 'training' },     // 16 marzo
                    18: { status: 'lesionado', type: 'training' },  // 18 marzo
                    19: { status: 'lesionado', type: 'training' },  // 19 marzo
                    21: { status: 'no-asiste', type: 'training' },  // 21 marzo
                    22: { status: 'asiste', type: 'training' },     // 22 marzo
                    24: { status: 'asiste', type: 'training' },     // 24 marzo
                    27: { status: 'asiste', type: 'match' },        // 27 marzo
                    28: { status: 'no-asiste', type: 'training' },  // 28 marzo
                    29: { status: 'asiste', type: 'training' },     // 29 marzo
                }
            }
        };

        // Configuración de colores
        const statusColors = {
            'asiste': '#9747FF',
            'no-asiste': '#108B37', 
            'lesionado': '#CF5904',
            'tarde': '#00ACC1'
        };

        // Datos de desempeño técnico (ejemplo para backend)
        const performanceData = {
            // Datos para gráfico de progreso físico (línea)
            physicalProgress: [
                { week: 0, value: 850 },
                { week: 1, value: 1000 },
                { week: 2, value: 50 },
                { week: 3, value: 700 },
                { week: 4, value: 200 },
                { week: 5, value: 400 },
                { week: 6, value: 1000 }
            ],
            
            // Datos para composición corporal (donut)
            bodyComposition: {
                moderateFat: 25,    // Grasa corporal moderada (morado)
                highFat: 15,        // Grasa corporal alta (verde claro)
                optimalMuscle: 60   // Masa muscular óptima (verde oscuro)
            },
            
            // Datos para rendimiento semanal (barras)
            weeklyPerformance: [
                { week: 0, blue: 750, green: 450 },
                { week: 1, blue: 350, green: 800 },
                { week: 2, blue: 200, green: 600 },
                { week: 3, blue: 300, green: 300 },
                { week: 4, blue: 500, green: 1000 }
            ],
            
            // Datos del jugador
            playerInfo: {
                name: "Martínez Gonzalo",
                position: "3ra línea - Apertura",
                status: "Activo - Primera",
                attendance: "80%",
                photo: "../recursos/player-martinez.jpg" // Ruta de la foto del jugador
            }
        };

        // Variables globales
        let currentDate = new Date(2025, 2, 1); // Marzo 2025
        let attendanceChart = null;
        let progressChart = null;
        let bodyCompositionChart = null;
        let weeklyChart = null;

        // Verificar autenticación al cargar la página
        document.addEventListener('DOMContentLoaded', function () {
            // Si no está logueado, redirigir al home
            if (!auth.isLoggedIn()) {
                alert('Debes iniciar sesión para acceder al panel de rendimiento');
                window.location.href = '../index.html';
                return;
            }

            // Si está logueado, actualizar la navegación
            auth.updateNavigation();
            initializePanelTabs();
            initializeCalendar();
            initializeAttendanceChart();
        });

        // Inicializar sistema de pestañas
        function initializePanelTabs() {
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');

                    // Remover clase active de todos los botones y contenidos
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        content.style.display = 'none';
                    });

                    // Agregar clase active al botón clickeado
                    this.classList.add('active');

                    // Mostrar el contenido correspondiente
                    const targetContent = document.getElementById(targetTab);
                    if (targetContent) {
                        targetContent.classList.add('active');
                        targetContent.style.display = 'block';
                        
                        // Inicializar gráfico cuando se abra la pestaña de asistencias
                        if (targetTab === 'asistencias' && !attendanceChart) {
                            setTimeout(() => {
                                initializeAttendanceChart();
                            }, 100);
                        }
                        
                        // Inicializar gráficos cuando se abra la pestaña de desempeño
                        if (targetTab === 'desempeno' && !progressChart) {
                            setTimeout(() => {
                                initializePerformanceCharts();
                                loadPlayerInfo();
                            }, 100);
                        }
                    }
                });
            });
        }

        // Inicializar calendario
        function initializeCalendar() {
            updateCalendarDisplay();
            
            document.getElementById('prevMonth').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                updateCalendarDisplay();
                updateAttendanceChart();
            });
            
            document.getElementById('nextMonth').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                updateCalendarDisplay();
                updateAttendanceChart();
            });
        }

        // Actualizar visualización del calendario
        function updateCalendarDisplay() {
            const monthNames = ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio',
                               'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'];
            
            document.getElementById('currentMonth').textContent = monthNames[currentDate.getMonth()];
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = (firstDay.getDay() + 6) % 7; // Ajustar para que lunes sea 0
            
            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';
            
            // Días del mes anterior (grises)
            for (let i = startingDayOfWeek - 1; i >= 0; i--) {
                const prevMonthDay = new Date(year, month, -i);
                const dayElement = createDayElement(prevMonthDay.getDate(), 'prev-month');
                calendarDays.appendChild(dayElement);
            }
            
            // Días del mes actual
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = createDayElement(day, 'current-month');
                
                // Aplicar estado de asistencia si existe
                const monthData = attendanceData[year] && attendanceData[year][month];
                if (monthData && monthData[day]) {
                    const status = monthData[day].status;
                    dayElement.style.backgroundColor = statusColors[status];
                    dayElement.style.color = 'white';
                    dayElement.classList.add('has-attendance');
                }
                
                calendarDays.appendChild(dayElement);
            }
            
            // Días del mes siguiente (grises)
            const totalCells = calendarDays.children.length;
            const remainingCells = 42 - totalCells; // 6 semanas × 7 días
            for (let day = 1; day <= remainingCells; day++) {
                const dayElement = createDayElement(day, 'next-month');
                calendarDays.appendChild(dayElement);
            }
        }

        // Crear elemento de día
        function createDayElement(day, monthType) {
            const dayElement = document.createElement('div');
            dayElement.className = `calendar-day ${monthType}`;
            dayElement.textContent = day;
            return dayElement;
        }

        // Inicializar gráfico de asistencias
        function initializeAttendanceChart() {
            const canvas = document.getElementById('attendanceChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const stats = calculateAttendanceStats();
            
            // Limpiar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Configuración del gráfico
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 80;
            const lineWidth = 20;
            
            // Calcular ángulos
            const attendedAngle = (stats.attended / stats.total) * 2 * Math.PI;
            const absentAngle = (stats.absent / stats.total) * 2 * Math.PI;
            
            // Dibujar círculo de fondo
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            ctx.strokeStyle = '#e9ecef';
            ctx.lineWidth = lineWidth;
            ctx.stroke();
            
            // Dibujar segmento de asistencias (morado)
            if (stats.attended > 0) {
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, -Math.PI/2, -Math.PI/2 + attendedAngle);
                ctx.strokeStyle = statusColors['asiste'];
                ctx.lineWidth = lineWidth;
                ctx.stroke();
            }
            
            // Dibujar segmento de ausencias (verde)
            if (stats.absent > 0) {
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, -Math.PI/2 + attendedAngle, -Math.PI/2 + attendedAngle + absentAngle);
                ctx.strokeStyle = statusColors['no-asiste'];
                ctx.lineWidth = lineWidth;
                ctx.stroke();
            }
            
            // Actualizar porcentaje
            const percentage = Math.round((stats.attended / stats.total) * 100);
            document.getElementById('attendancePercentage').textContent = `${percentage}%`;
        }

        // Calcular estadísticas de asistencia
        function calculateAttendanceStats() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const monthData = attendanceData[year] && attendanceData[year][month];
            
            let attended = 0;
            let absent = 0;
            let injured = 0;
            let late = 0;
            
            if (monthData) {
                Object.values(monthData).forEach(entry => {
                    switch(entry.status) {
                        case 'asiste':
                            attended++;
                            break;
                        case 'no-asiste':
                            absent++;
                            break;
                        case 'lesionado':
                            injured++;
                            break;
                        case 'tarde':
                            late++;
                            break;
                    }
                });
            }
            
            const total = attended + absent;
            return { attended, absent, injured, late, total };
        }

        // Actualizar gráfico cuando cambie el mes
        function updateAttendanceChart() {
            if (document.getElementById('asistencias').style.display !== 'none') {
                initializeAttendanceChart();
            }
        }

        // Funciones para futuras implementaciones
        function exportGymData() {
            alert('Exportar datos de gimnasio - Próximamente');
        }

        function addNewExercise() {
            alert('Agregar nuevo ejercicio - Próximamente');
        }

        // Función para backend: obtener datos de asistencia
        function getAttendanceData(year, month) {
            // Esta función será reemplazada por llamada al backend
            return attendanceData[year] && attendanceData[year][month] || {};
        }

        // Inicializar gráficos de desempeño técnico
        function initializePerformanceCharts() {
            initializeProgressChart();
            initializeBodyCompositionChart();
            initializeWeeklyPerformanceChart();
        }

        // Gráfico de progreso físico (línea)
        function initializeProgressChart() {
            const canvas = document.getElementById('progressChart');
            if (!canvas) return;
            
            // Ajustar tamaño del canvas según el dispositivo
            const isMobile = window.innerWidth <= 767;
            canvas.width = isMobile ? 300 : 400;
            canvas.height = isMobile ? 150 : 200;
            
            const ctx = canvas.getContext('2d');
            const data = performanceData.physicalProgress;
            
            // Limpiar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Configuración
            const padding = isMobile ? 30 : 40;
            const chartWidth = canvas.width - (padding * 2);
            const chartHeight = canvas.height - (padding * 2);
            const maxValue = 1000;
            
            // Dibujar ejes
            ctx.strokeStyle = '#e9ecef';
            ctx.lineWidth = 1;
            
            // Eje Y (líneas horizontales)
            for (let i = 0; i <= 4; i++) {
                const y = padding + (chartHeight * i / 4);
                const value = maxValue - (maxValue * i / 4);
                
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(padding + chartWidth, y);
                ctx.stroke();
                
                // Etiquetas del eje Y
                ctx.fillStyle = '#6c757d';
                ctx.font = isMobile ? '10px Arial' : '12px Arial';
                ctx.textAlign = 'right';
                ctx.fillText(value.toString(), padding - 10, y + 4);
            }
            
            // Eje X (líneas verticales)
            for (let i = 0; i <= 6; i++) {
                const x = padding + (chartWidth * i / 6);
                
                ctx.beginPath();
                ctx.moveTo(x, padding);
                ctx.lineTo(x, padding + chartHeight);
                ctx.stroke();
                
                // Etiquetas del eje X
                ctx.fillStyle = '#6c757d';
                ctx.font = isMobile ? '10px Arial' : '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(i.toString(), x, padding + chartHeight + (isMobile ? 15 : 20));
            }
            
            // Dibujar línea de datos
            ctx.strokeStyle = '#9747FF';
            ctx.lineWidth = isMobile ? 2 : 3;
            ctx.beginPath();
            
            data.forEach((point, index) => {
                const x = padding + (chartWidth * point.week / 6);
                const y = padding + chartHeight - (chartHeight * point.value / maxValue);
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
                
                // Dibujar puntos
                ctx.fillStyle = '#9747FF';
                ctx.beginPath();
                ctx.arc(x, y, isMobile ? 3 : 4, 0, 2 * Math.PI);
                ctx.fill();
            });
            
            ctx.stroke();
            progressChart = true;
        }

        // Gráfico de composición corporal (donut)
        function initializeBodyCompositionChart() {
            const canvas = document.getElementById('bodyCompositionChart');
            if (!canvas) return;
            
            // Ajustar tamaño del canvas según el dispositivo
            const isMobile = window.innerWidth <= 767;
            canvas.width = isMobile ? 120 : 200;
            canvas.height = isMobile ? 120 : 200;
            
            const ctx = canvas.getContext('2d');
            const data = performanceData.bodyComposition;
            
            // Limpiar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Configuración
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = isMobile ? 40 : 70;
            const lineWidth = isMobile ? 15 : 25;
            
            // Calcular ángulos
            const total = data.moderateFat + data.highFat + data.optimalMuscle;
            const moderateAngle = (data.moderateFat / total) * 2 * Math.PI;
            const highAngle = (data.highFat / total) * 2 * Math.PI;
            const optimalAngle = (data.optimalMuscle / total) * 2 * Math.PI;
            
            let currentAngle = -Math.PI / 2;
            
            // Dibujar segmento de grasa moderada (morado)
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + moderateAngle);
            ctx.strokeStyle = '#9747FF';
            ctx.lineWidth = lineWidth;
            ctx.stroke();
            currentAngle += moderateAngle;
            
            // Dibujar segmento de grasa alta (verde claro)
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + highAngle);
            ctx.strokeStyle = '#7CB342';
            ctx.lineWidth = lineWidth;
            ctx.stroke();
            currentAngle += highAngle;
            
            // Dibujar segmento de masa muscular óptima (verde oscuro)
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + optimalAngle);
            ctx.strokeStyle = '#2E7D32';
            ctx.lineWidth = lineWidth;
            ctx.stroke();
            
            bodyCompositionChart = true;
        }

        // Gráfico de rendimiento semanal (barras)
        function initializeWeeklyPerformanceChart() {
            const canvas = document.getElementById('weeklyPerformanceChart');
            if (!canvas) return;
            
            // Ajustar tamaño del canvas según el dispositivo
            const isMobile = window.innerWidth <= 767;
            canvas.width = isMobile ? 350 : 500;
            canvas.height = isMobile ? 180 : 250;
            
            const ctx = canvas.getContext('2d');
            const data = performanceData.weeklyPerformance;
            
            // Limpiar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Configuración
            const padding = isMobile ? 30 : 40;
            const chartWidth = canvas.width - (padding * 2);
            const chartHeight = canvas.height - (padding * 2);
            const maxValue = 1000;
            const barWidth = chartWidth / (data.length * 2.5);
            
            // Dibujar ejes
            ctx.strokeStyle = '#e9ecef';
            ctx.lineWidth = 1;
            
            // Eje Y (líneas horizontales)
            for (let i = 0; i <= 4; i++) {
                const y = padding + (chartHeight * i / 4);
                const value = maxValue - (maxValue * i / 4);
                
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(padding + chartWidth, y);
                ctx.stroke();
                
                // Etiquetas del eje Y
                ctx.fillStyle = '#6c757d';
                ctx.font = isMobile ? '10px Arial' : '12px Arial';
                ctx.textAlign = 'right';
                ctx.fillText(value.toString(), padding - 10, y + 4);
            }
            
            // Dibujar barras
            data.forEach((point, index) => {
                const x = padding + (chartWidth * (index + 0.5) / data.length) - barWidth;
                
                // Barra azul
                const blueHeight = (chartHeight * point.blue / maxValue);
                const blueY = padding + chartHeight - blueHeight;
                ctx.fillStyle = '#00ACC1';
                ctx.fillRect(x, blueY, barWidth * 0.8, blueHeight);
                
                // Barra verde
                const greenHeight = (chartHeight * point.green / maxValue);
                const greenY = padding + chartHeight - greenHeight;
                ctx.fillStyle = '#7CB342';
                ctx.fillRect(x + barWidth * 0.9, greenY, barWidth * 0.8, greenHeight);
                
                // Etiqueta del eje X
                ctx.fillStyle = '#6c757d';
                ctx.font = isMobile ? '10px Arial' : '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(point.week.toString(), x + barWidth, padding + chartHeight + (isMobile ? 15 : 20));
            });
            
            weeklyChart = true;
        }

        // Función para redibujar gráficos cuando cambie el tamaño de pantalla
        function redrawChartsOnResize() {
            if (progressChart) {
                progressChart = false;
                initializeProgressChart();
            }
            if (bodyCompositionChart) {
                bodyCompositionChart = false;
                initializeBodyCompositionChart();
            }
            if (weeklyChart) {
                weeklyChart = false;
                initializeWeeklyPerformanceChart();
            }
        }

        // Agregar listener para redimensionamiento
        window.addEventListener('resize', function() {
            setTimeout(redrawChartsOnResize, 100);
        });

        // Cargar información del jugador
        function loadPlayerInfo() {
            const playerInfo = performanceData.playerInfo;
            
            // Actualizar nombre
            document.getElementById('playerName').textContent = playerInfo.name;
            
            // Actualizar imagen si existe
            const playerImage = document.getElementById('playerImage');
            playerImage.src = playerInfo.photo;
            
            // Actualizar detalles del jugador
            const playerCard = document.querySelector('.player-card');
            const detailItems = playerCard.querySelectorAll('.detail-item span');
            
            if (detailItems[0]) detailItems[0].textContent = playerInfo.position;
            if (detailItems[1]) detailItems[1].textContent = `● ${playerInfo.status}`;
        }
        // Función para backend: actualizar datos de asistencia
        function updateAttendanceData(year, month, day, status, type) {
            // Esta función será reemplazada por llamada al backend
            if (!attendanceData[year]) attendanceData[year] = {};
            if (!attendanceData[year][month]) attendanceData[year][month] = {};
            attendanceData[year][month][day] = { status, type };
            
            updateCalendarDisplay();
            updateAttendanceChart();
        }

        // Funciones para backend - Desempeño técnico
        function getPerformanceData() {
            // Esta función será reemplazada por llamada al backend
            return performanceData;
        }

        function updatePlayerPhoto(photoFile) {
            // Esta función será reemplazada por llamada al backend
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('playerImage').src = e.target.result;
                performanceData.playerInfo.photo = e.target.result;
            };
            reader.readAsDataURL(photoFile);
        }
    </script>
</body>

</html>